<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHAT U VIBIN TO?</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="marquee-wrapper">
    <div class="marquee-content">
        WHAT U VIBIN TO? /// WHAT U VIBIN TO? /// WHAT U VIBIN TO? /// I WANNA GO TO AMSTERDAM /// WHAT U VIBIN TO? /// WHAT U VIBIN TO? /// WHAT U VIBIN TO? /// WHAT U VIBIN TO? /// TOKYO /// STRICTLY VINYL ///
    </div>
</div>

<div class="container">
    <div class="header-logo-wrapper">
        <a href="index.html">
            <img src="images/logo.svg" alt="WHAT U VIBIN TO?">
        </a>
    </div>

    <div class="main-content">
        <nav class="nav-links">
            <a href="about.html">About</a>
            <a href="books.html">Books</a>
            <a href="contact.html">Contact</a>
            <a href="dig.html" class="special-link">Dig for new music</a>
            <a href="event.html">Events</a>
        </nav>

        <div class="record-wrapper" id="recordArea">
            <img src="images/record.svg" alt="Vinyl Record" class="record-img" id="recordDisk">
        </div>
    </div>

    <div class="footer">
        Developed by Lucy, Wassup bro
    </div>
</div>

<audio id="scratchAudio" src="scratch.mp3" preload="auto"></audio>

<script>
    /* --- JavaScript スクラッチ機能 --- */

    const recordArea = document.getElementById('recordArea');
    const recordDisk = document.getElementById('recordDisk');
    const audio = document.getElementById('scratchAudio');

    let isDragging = false;
    let startAngle = 0;
    let currentRotation = 0;
    let lastRotation = 0;
    let previousPlayTime = 0;

    function getCenter(element) {
        const rect = element.getBoundingClientRect();
        return {
            x: rect.left + rect.width / 2,
            y: rect.top + rect.height / 2
        };
    }

    function getAngle(x, y, center) {
        const dy = y - center.y;
        const dx = x - center.x;
        let theta = Math.atan2(dy, dx); 
        theta *= 180 / Math.PI; 
        return theta;
    }

    function playScratchSound() {
        const now = Date.now();
        if (now - previousPlayTime > 100) {
            audio.currentTime = 0;
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Audio play prevented needed interaction first.");
                });
            }
            previousPlayTime = now;
        }
    }

    // PC Mouse Events
    recordArea.addEventListener('mousedown', (e) => {
        // e.preventDefault(); 削除しました
        isDragging = true;
        const center = getCenter(recordArea);
        startAngle = getAngle(e.clientX, e.clientY, center) - currentRotation;
        recordArea.style.cursor = 'grabbing';
    });

    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        // e.preventDefault(); 削除しました
        const center = getCenter(recordArea);
        const angle = getAngle(e.clientX, e.clientY, center);
        const newRotation = angle - startAngle;
        recordDisk.style.transform = `rotate(${newRotation}deg)`;

        if (Math.abs(newRotation - lastRotation) > 2) {
            playScratchSound();
        }
        currentRotation = newRotation;
        lastRotation = newRotation;
    });

    window.addEventListener('mouseup', () => {
        isDragging = false;
        recordArea.style.cursor = 'grab';
    });

    // Touch Events
    recordArea.addEventListener('touchstart', (e) => {
        // e.preventDefault(); 削除しました
        isDragging = true;
        const touch = e.touches[0];
        const center = getCenter(recordArea);
        startAngle = getAngle(touch.clientX, touch.clientY, center) - currentRotation;
    }, { passive: false });

    window.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        // e.preventDefault(); 削除しました
        const touch = e.touches[0];
        const center = getCenter(recordArea);
        const angle = getAngle(touch.clientX, touch.clientY, center);
        const newRotation = angle - startAngle;
        recordDisk.style.transform = `rotate(${newRotation}deg)`;

        if (Math.abs(newRotation - lastRotation) > 2) {
            playScratchSound();
        }
        currentRotation = newRotation;
        lastRotation = newRotation;
    }, { passive: false });

    window.addEventListener('touchend', () => {
        isDragging = false;
    });
</script>

</body>
</html>
