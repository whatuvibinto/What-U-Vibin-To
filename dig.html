<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIG - WHAT U VIBIN TO?</title>
    <link rel="stylesheet" href="css/style_index.css">
    <link rel="stylesheet" href="css/style_dig.css">
</head>
<body class="dig-page">

<div class="marquee-wrapper">
    <div class="marquee-content">
        WHAT U VIBIN TO? /// KEEP DIGGING /// WHAT U VIBIN TO? /// KEEP DIGGING /// WHAT U VIBIN TO? /// KEEP DIGGING ///
    </div>
</div>

<div class="container">
    <div class="header-logo-wrapper dig-logo">
        <a href="index.html">
            <img src="images/logo.svg" alt="WHAT U VIBIN TO?">
        </a>
    </div>

    <div class="dig-content">
        <div class="search-area">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="NAME or LOCATION...">
                <button class="search-btn">SEARCH</button>
            </div>
        </div>

        <div class="profile-list" id="profileContainer">
            </div>
    </div>

    <div class="footer">
        KEEP DIGGING, KEEP VIBING.
    </div>
</div>

<div class="qr-modal-overlay" id="qrModal">
    <div class="qr-modal-content">
        <span class="qr-modal-close" onclick="closeQrModal()">&times;</span>
        
        <h2 class="qr-modal-name" id="modalName">NAME</h2>
        <p class="qr-modal-genre" id="modalGenre">GENRE</p>

        <div class="qr-modal-body">
            <div class="qr-modal-photo-area">
                <img src="" alt="Profile Photo" class="qr-modal-photo" id="modalPhoto">
            </div>
            <div class="qr-modal-code-area">
                <img src="" alt="QR Code" class="qr-modal-qr" id="modalQr">
                <p class="qr-instruction">Scan to listen</p>
            </div>
        </div>
    </div>
</div>

<script src="js/dig_data.js"></script>
<script>
    const container = document.getElementById('profileContainer');
    const modal = document.getElementById('qrModal');
    
    // モーダル内の要素
    const modalName = document.getElementById('modalName');
    const modalGenre = document.getElementById('modalGenre');
    const modalPhoto = document.getElementById('modalPhoto');
    const modalQr = document.getElementById('modalQr');

    function renderProfiles(data) {
        let html = '';
        data.forEach((person, index) => {
            const delay = index * 0.05; 
            const genreText = person.genre.join(', ');

            // ★修正: dig_data.js から serviceIcon を取得
            // データが無い場合の予備画像(任意)も設定可能
            const serviceIconUrl = person.serviceIcon || "images/default_icon.png"; 

            html += `
            <div class="profile-card" style="animation-delay: ${delay}s" 
                 onclick="openQrModal('${person.name}', '${genreText}', '${person.image}', '${person.qr}')">
                
                <div class="profile-img">
                    <img src="${person.image}" alt="${person.name}">
                </div>

                <div class="profile-info">
                    <h2 class="profile-name">${person.name}</h2>
                    <span class="profile-loc">${person.location}</span>
                    <p class="profile-genre-text">${genreText}</p>
                    
                    <div class="profile-bottom-row">
                        <div class="mini-qr-wrapper">
                            <img src="${person.qr}" alt="QR" class="mini-qr">
                        </div>
                        <div class="service-icon-wrapper">
                            <img src="${serviceIconUrl}" alt="Service" class="service-icon">
                        </div>
                    </div>
                </div>
            </div>
            `;
        });
        container.innerHTML = html;
    }

    renderProfiles(digData);

    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = digData.filter(person => 
            person.name.toLowerCase().includes(term) || 
            person.location.toLowerCase().includes(term) ||
            person.genre.some(g => g.toLowerCase().includes(term))
        );
        renderProfiles(filtered);
    });

    // --- モーダル制御 ---
    window.openQrModal = function(name, genre, imageSrc, qrSrc) {
        modalName.textContent = name;
        modalGenre.textContent = genre;
        modalPhoto.src = imageSrc;
        modalQr.src = qrSrc;
        
        modal.classList.add('active');
    };

    window.closeQrModal = function() {
        modal.classList.remove('active');
    };

    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeQrModal();
    });
</script>

</body>
</html>
