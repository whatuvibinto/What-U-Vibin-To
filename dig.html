<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIG - WHAT U VIBIN TO?</title>
    <link rel="stylesheet" href="css/style_index.css">
    <link rel="stylesheet" href="css/style_dig.css">
</head>
<body class="dig-page">

<div class="marquee-wrapper">
    <div class="marquee-content">
        WHAT U VIBIN TO? /// LOVE IS FREE /// WHAT U VIBIN TO? /// KEEP DIGGING /// WHAT U VIBIN TO? /// LOVE IS FREE ///
    </div>
</div>

<div class="container">
    <div class="header-logo-wrapper dig-logo">
        <a href="index.html">
            <img src="images/logo.svg" alt="WHAT U VIBIN TO?">
        </a>
    </div>

    <div class="dig-content">
        <div class="search-area">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="NAME or LOCATION...">
                <button class="search-btn">SEARCH</button>
            </div>
            
            <div class="genre-filter-area">
                <div class="genre-label">FILTER BY GENRE:</div>
                <div class="genre-checkboxes" id="genreCheckboxes"></div>
                <button class="filter-reset-btn" id="resetBtn" style="display:none;">RESET (ALL)</button>
            </div>
        </div>

        <div class="profile-list" id="profileContainer">
            </div>
    </div>

    <div class="footer">
        KEEP DIGGING, KEEP VIBING.
    </div>
</div>

<div class="qr-modal" id="qrModal">
    <div class="qr-modal-overlay" onclick="closeQrModal()"></div>
    <div class="qr-modal-content art-layout">
        <button class="modal-close-btn" onclick="closeQrModal()">×</button>
        
        <div class="art-image-section">
            <img id="modalPhoto" src="" alt="Profile Photo">
        </div>

        <div class="art-info-section">
            <div class="art-header">
                <div class="art-meta">
                    <span id="modalLocation" class="art-loc">LOCATION</span>
                    <span id="modalRole" class="art-role">ROLE</span>
                </div>
                <h2 id="modalName" class="art-name">NAME</h2>
                <p id="modalGenre" class="art-genre">GENRE</p>
            </div>

            <div id="modalInstaArea" class="art-insta-area" style="display:none;">
                </div>

            <div class="art-info-footer">
                <span class="art-scan-text">Scan or Touch this QR</span>
                <a id="modalQrLink" href="" target="_blank" class="art-qr-link">
                    <img id="modalQr" src="" alt="QR Code">
                </a>
            </div>
        </div>
    </div>
</div>

<script src="js/dig_data.js"></script>
<script>
    const container = document.getElementById('profileContainer');
    const searchInput = document.getElementById('searchInput');
    const genreContainer = document.getElementById('genreCheckboxes');
    const resetBtn = document.getElementById('resetBtn');

    // モーダル要素
    const modal = document.getElementById('qrModal');
    const modalName = document.getElementById('modalName');
    const modalGenre = document.getElementById('modalGenre');
    const modalLocation = document.getElementById('modalLocation');
    const modalRole = document.getElementById('modalRole');
    const modalPhoto = document.getElementById('modalPhoto');
    const modalQr = document.getElementById('modalQr');
    const modalQrLink = document.getElementById('modalQrLink');
    const modalInstaArea = document.getElementById('modalInstaArea');

    let selectedGenres = [];

    // --- 1. ジャンル一覧を取得してフィルターを作成 ---
    function initFilters() {
        const allGenres = new Set();
        digData.forEach(person => person.genre.forEach(g => allGenres.add(g)));
        
        allGenres.forEach(genre => {
            const label = document.createElement('label');
            label.className = 'genre-checkbox-label';
            label.innerHTML = `
                <input type="checkbox" value="${genre}" onchange="toggleGenre('${genre}')">
                <span>${genre}</span>
            `;
            genreContainer.appendChild(label);
        });
    }

    // --- 2. プロフィール描画 (高さ統一・ロゴ色加工なし) ---
    function renderProfiles(data) {
        let html = '';
        data.forEach((person, index) => {
            const tags = person.genre.map(g => `<span class="tag">${g}</span>`).join('');
            const delay = index * 0.05; 

            html += `
            <div class="profile-card" onclick="openQrModal('${person.name.replace(/'/g, "\\'")}', '${person.genre.join(', ')}', '${person.image}', '${person.qr}', '${person.qrLink}', '${person.instagram || ""}', '${person.role || ""}', '${person.location}')" style="animation-delay: ${delay}s">
                <div class="profile-img">
                    <img src="${person.image}" alt="${person.name}">
                </div>
                <div class="profile-info">
                    <div class="profile-name-group">
                        <h2 class="profile-name">${person.name}</h2>
                        <span class="profile-loc">/ ${person.location}</span>
                    </div>
                    <div class="profile-genre">
                        <div class="service-icon"><img src="${person.serviceIcon}" alt="service"></div>
                        <div class="tags-container">${tags}</div>
                    </div>
                    <div class="profile-qr">
                        <img src="${person.qr}" alt="QR Code">
                        <span class="qr-text">SCAN OR TOUCH</span>
                    </div>
                </div>
            </div>
            `;
        });
        container.innerHTML = html || '<p style="color:#666; font-weight:bold; padding:20px;">No results found.</p>';
    }

    // --- 3. フィルター適用 ---
    function applyFilters() {
        const term = searchInput.value.toLowerCase();
        const filtered = digData.filter(person => {
            const matchesSearch = person.name.toLowerCase().includes(term) || person.location.toLowerCase().includes(term);
            const matchesGenre = selectedGenres.length === 0 || selectedGenres.every(g => person.genre.includes(g));
            return matchesSearch && matchesGenre;
        });
        renderProfiles(filtered);
        resetBtn.style.display = (term || selectedGenres.length > 0) ? 'inline-block' : 'none';
    }

    window.toggleGenre = function(val) {
        if (!selectedGenres.includes(val)) {
            selectedGenres.push(val);
        } else {
            selectedGenres = selectedGenres.filter(g => g !== val);
        }
        applyFilters();
    };

    resetBtn.addEventListener('click', () => {
        selectedGenres = [];
        searchInput.value = '';
        const checkboxes = genreContainer.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        applyFilters();
    });

    searchInput.addEventListener('input', applyFilters);

    // --- 4. モーダル制御 (文言・矢印・スタイルの修正) ---
    window.openQrModal = function(name, genre, imageSrc, qrSrc, linkUrl, instaId, role, location) {
        modalName.textContent = name;
        modalGenre.textContent = genre;
        modalLocation.textContent = location;
        modalPhoto.src = imageSrc;
        modalQr.src = qrSrc;
        modalQrLink.href = linkUrl;

        if (role) {
            modalRole.textContent = role;
            modalRole.style.display = "block";
        } else {
            modalRole.style.display = "none";
        }

        if (instaId) {
            modalInstaArea.innerHTML = `
                <div class="art-insta-area">
                    <span class="insta-label-styled">Tap & Check the profile</span>
                    <a href="https://instagram.com/${instaId}" target="_blank" class="insta-link-group" style="text-decoration:none; color:#000; display:flex; align-items:center;">
                        <span class="insta-arrow" style="margin-right:5px; font-size:1.2rem;">←</span>
                        <span class="art-insta-name" style="font-weight:900;">IG. ${instaId}</span>
                    </a>
                </div>
            `;
            modalInstaArea.style.display = "block";
        } else {
            modalInstaArea.style.display = "none";
        }

        modal.classList.add('active');
    };

    window.closeQrModal = function() {
        modal.classList.remove('active');
    };

    // 初期化
    initFilters();
    renderProfiles(digData);
</script>

</body>
</html>
