<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EXPLORE | WHAT U VIBIN TO?</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/explore.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
</head>
<body class="explore-page-body">

    <header class="site-header">
        <div class="logo-container">
            <a href="index.html" class="logo-link">
                <img src="images/white_logo.png" alt="WHAT U VIBIN TO?" class="header-logo">
            </a>
        </div>
        
        <button id="menuBtn" class="menu-btn" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <div id="menuPanel" class="menu-panel">
        <nav class="menu-nav">
            <a href="index.html" class="nav-link" onclick="closeMenu()">
                <span class="nav-en">Home</span>
                <span class="nav-jp">トップページに戻る</span>
            </a>
            <a href="explore.html" class="nav-link highlight" onclick="closeMenu()">
                <span class="nav-en">Explore</span>
                <span class="nav-jp">あの人の"この時間"をのぞく</span>
            </a>
            <a href="how.html" class="nav-link" onclick="closeMenu()">
                <span class="nav-en">How it works</span>
                <span class="nav-jp">仕組み / 使い方</span>
            </a>
            <a href="getQR.html" class="nav-link" onclick="closeMenu()">
                <span class="nav-en">Get QR</span>
                <span class="nav-jp">あなただけのQRをつくる</span>
            </a>
        </nav>
    </div>

    <main class="explore-main-content">

        <div class="bg-layer">
            <!--<img src="images/whiteQR_background.PNG" alt="" class="bg-image">-->
            <div class="glow-spot-1"></div>
            <div class="glow-spot-2"></div>
            <div class="glow-bottom"></div>
        </div>

        <div class="explore-container">
            <div class="dig-content">
                
                <div class="explore-hero">
                    <h2 class="explore-main-copy">
                        THIS QR IS ALIVE.
                    </h2>
                    <p class="explore-sub-copy">
                        時間帯で変わる、<br>
                        リアルタイムなバイブスをチェック。
                    </p>
                </div>

                <div class="search-area">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="Name, Location or Genre...">
                        <button class="search-btn">SEARCH</button>
                    </div>
                    <div class="genre-filter-area">
                        <div class="genre-label">FILTER BY GENRE:</div>
                        <div class="genre-checkboxes" id="genreCheckboxes"></div>
                        <button class="filter-reset-btn" id="resetBtn" style="display:none;">RESET ALL</button>
                    </div>
                </div>

                <div class="profile-list" id="profileContainer"></div>
                
                <div class="explore-footer">
                    KEEP DIGGING, KEEP VIBING.
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <p class="copyright">
            © 2026 WHAT U VIBIN TO
        </p>
    </footer>

    <div class="qr-modal-overlay" id="qrModal">
        <div class="qr-modal-content art-layout">
  <button class="qr-modal-close" onclick="closeQrModal()"></button>

  <!-- Background Image -->
  <div class="art-bg">
    <img id="modalPhoto" src="">
  </div>

  <!-- Overlay Content -->
  <div class="art-overlay">

    <!-- Artist Header -->
    <div class="art-header">
      <h1 id="modalName" class="art-title">DJ NAME</h1>
      <div class="art-meta">
        <span id="modalLocation">TOKYO</span>
        <span>—</span>
        <span id="modalGenre">HOUSE</span>
      </div>
    </div>

    <!-- QR Area -->
    <div class="art-qr-section">
      <a id="modalQrLink" target="_blank">
        <img id="modalQr" src="">
      </a>
      <p class="qr-caption">SCAN TO FEEL CURRENT VIBE</p>
    </div>

    <!-- Social -->
    <a id="modalInstaLink" target="_blank" class="art-social">
      <img src="images/InstagramLogo.png">
      <span id="modalInstaName">@username</span>
    </a>

  </div>
</div>

    </div>

    <script src="js/dig_data.js"></script>

    <script>
        // --- Menu Logic ---
        const menuBtn = document.getElementById('menuBtn');
        const menuPanel = document.getElementById('menuPanel');
        let isMenuOpen = false;

        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            if (isMenuOpen) {
                menuPanel.classList.add('menu-open');
                menuBtn.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                closeMenu();
            }
        }
        function closeMenu() {
            isMenuOpen = false;
            menuPanel.classList.remove('menu-open');
            menuBtn.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        menuBtn.addEventListener('click', toggleMenu);

        // --- Explore Logic ---
        const container = document.getElementById('profileContainer');
        const modal = document.getElementById('qrModal');
        const mName = document.getElementById('modalName');
        const mGenre = document.getElementById('modalGenre');
        const mPhoto = document.getElementById('modalPhoto');
        const mQr = document.getElementById('modalQr');
        const mQrLink = document.getElementById('modalQrLink');
        const mRole = document.getElementById('modalRole');
        const mLocation = document.getElementById('modalLocation');
        const mInstaArea = document.getElementById('modalInstaArea');
        const mInstaLink = document.getElementById('modalInstaLink');
        const mInstaName = document.getElementById('modalInstaName');
        const searchInput = document.getElementById('searchInput');
        const genreContainer = document.getElementById('genreCheckboxes');
        const resetBtn = document.getElementById('resetBtn');

        let currentSearchTerm = '';
        let selectedGenres = []; 
        let profileData = [];
        
        initExplore();

        function initExplore() {
            if (typeof window.digData !== 'undefined') profileData = window.digData;
            else if (typeof digData !== 'undefined') profileData = digData;

            if(profileData.length > 0) {
                profileData.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
                generateGenreCheckboxes(); 
                renderProfiles(profileData); 
            }
        }

        function generateGenreCheckboxes() {
            let allGenres = [...new Set(profileData.flatMap(person => person.genre))].sort();
            const mixTag = "DJ MIX";
            if (allGenres.includes(mixTag)) {
                allGenres = allGenres.filter(g => g !== mixTag); 
                allGenres.unshift(mixTag); 
            }
            let html = '';
            allGenres.forEach(genre => {
                const specialClass = (genre === mixTag) ? 'special-tag' : '';
                html += `<label class="genre-tag ${specialClass}"><input type="checkbox" value="${genre}" onchange="handleGenreChange(this)"><span class="genre-name">${genre}</span></label>`;
            });
            genreContainer.innerHTML = html;
        }

        function renderProfiles(data) {
            if (data.length === 0) {
                container.innerHTML = '<p style="text-align:center;width:100%;grid-column:1/-1;margin-top:50px;font-weight:bold;color:#fff;">NO VIBES FOUND...</p>';
                return;
            }
            let html = '';
            data.forEach((person, index) => {
                const delay = index * 0.05; 
                const genreText = person.genre.join(', ');
                const serviceIconUrl = person.serviceIcon || "images/default_icon.png"; 
                const role = person.role || "";
                const roleBadge = role ? `<span class="role-badge">${role}</span>` : "";
                let linkUrl = person.id ? `profile.html?id=${person.id}` : (person.qrLink || "#");
                const instaId = person.instagram || "";
                const location = person.location || "";

                html += `
                <div class="profile-card" style="animation-delay: ${delay}s" 
                     onclick="openQrModal('${person.name}', '${genreText}', '${person.image}', '${person.qr}', '${linkUrl}', '${instaId}', '${role}', '${location}')">
                    <div class="profile-img"><img src="${person.image}" alt="${person.name}">${roleBadge}</div>
                    <div class="profile-info">
                        <h2 class="profile-name">${person.name}</h2>
                        <span class="profile-loc">${person.location}</span>
                        <div class="profile-bottom-row">
                            <div class="mini-qr-wrapper"><img src="${person.qr}" alt="QR" class="mini-qr"></div>
                            <div class="service-icon-wrapper"><img src="${serviceIconUrl}" alt="Service" class="service-icon"></div>
                        </div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        function applyFilters() {
            const filtered = profileData.filter(person => {
                const term = currentSearchTerm.toLowerCase();
                const textMatch = !term || person.name.toLowerCase().includes(term) || person.location.toLowerCase().includes(term) || person.genre.some(g => g.toLowerCase().includes(term));
                const genreMatch = selectedGenres.length === 0 || person.genre.some(g => selectedGenres.includes(g));
                return textMatch && genreMatch;
            });
            renderProfiles(filtered);
            resetBtn.style.display = selectedGenres.length > 0 ? 'inline-block' : 'none';
        }

        searchInput.addEventListener('input', (e) => { currentSearchTerm = e.target.value; applyFilters(); });
        window.handleGenreChange = function(checkbox) {
            const val = checkbox.value;
            if (checkbox.checked) selectedGenres.push(val); else selectedGenres = selectedGenres.filter(g => g !== val);
            applyFilters();
        };
        resetBtn.addEventListener('click', () => {
            selectedGenres = [];
            genreContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            applyFilters();
        });

        window.openQrModal = function(name, genre, imageSrc, qrSrc, linkUrl, instaId, role, location) {
            mName.textContent = name;
            mGenre.textContent = genre;
            mLocation.textContent = location;
            mPhoto.src = imageSrc;
            mQr.src = qrSrc;
            mQrLink.href = linkUrl;
            if (role) { mRole.textContent = role; mRole.style.display = "inline-block"; } else { mRole.style.display = "none"; }
            if (instaId) { mInstaArea.style.display = "flex"; mInstaName.textContent = instaId; mInstaLink.href = "https://instagram.com/" + instaId; } else { mInstaArea.style.display = "none"; }
            modal.classList.add('active');
        };
        window.closeQrModal = function() { modal.classList.remove('active'); };
        modal.addEventListener('click', (e) => { if (e.target === modal) closeQrModal(); });
    </script>
</body>
</html>
